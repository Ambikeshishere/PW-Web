<!DOCTYPE html>
<html>
<head>
<title>PW Target vs Achievement</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  padding:16px;
  background:#020617;
  font-family:Inter,system-ui;
  color:white;
}
h1{
  font-size:26px;
  background:linear-gradient(90deg,#fb923c,#38bdf8);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.sub{color:#94a3b8;margin-bottom:16px}

.kpis{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:12px;
  margin-bottom:18px;
}
.card{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:14px;
  padding:14px;
  box-shadow:0 0 15px rgba(56,189,248,.15);
}
.big{font-size:22px;font-weight:700}
.label{color:#94a3b8;font-size:13px}

.grid{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:16px;
}

@media(max-width:768px){
  .kpis{grid-template-columns:1fr 1fr}
  .grid{grid-template-columns:1fr}
  canvas{max-height:280px}
}
</style>
</head>

<body>

<h1>PW Target vs Achievement</h1>
<div class="sub">Live from Google Sheets</div>

<div class="kpis">
  <div class="card"><div class="label">Total Target</div><div class="big" id="tTarget">0</div></div>
  <div class="card"><div class="label">Total Achieved</div><div class="big" id="tAch">0</div></div>
  <div class="card"><div class="label">Achievement %</div><div class="big" id="tPct">0%</div></div>
  <div class="card"><div class="label">Delta</div><div class="big" id="tDelta">0</div></div>
</div>

<div class="grid">
  <div class="card">
    <h3>Center Wise Performance</h3>
    <canvas id="bar"></canvas>
  </div>
  <div class="card">
    <h3>Target vs Achieved</h3>
    <canvas id="pie"></canvas>
  </div>
</div>

<script>
const csvURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKpBKtR4FPQlTcRkMLLoyfPpsINfTUph6ZY-fZ15VlYmh5QGoOYZstOigBcCzIM3tWiMElXgrC7rIs/pub?gid=529778447&single=true&output=csv";

Papa.parse(csvURL,{
  download:true,
  complete:(res)=>{
    const rows=res.data;

    let centers=[],targets=[],ach=[],deltas=[];
    let TT=0,TA=0;

    rows.forEach(r=>{
      const name=r[1];
      const t=parseFloat(r[2]);
      const a=parseFloat(r[3]);

      if(!name || name=="Grand Total" || isNaN(t)) return;

      centers.push(name);
      targets.push(t);
      ach.push(a);
      deltas.push(t-a);

      TT+=t;
      TA+=a;
    });

    document.getElementById("tTarget").innerText = TT.toLocaleString();
    document.getElementById("tAch").innerText = TA.toLocaleString();
    document.getElementById("tDelta").innerText = (TT-TA).toLocaleString();
    document.getElementById("tPct").innerText = Math.round(TA/TT*100)+"%";

    new Chart(bar,{
      type:"bar",
      data:{
        labels:centers,
        datasets:[
          {label:"Target",data:targets,backgroundColor:"#fb923c"},
          {label:"Achieved",data:ach,backgroundColor:"#38bdf8"}
        ]
      },
      options:{
        responsive:true,
        plugins:{legend:{labels:{color:"white"}}},
        scales:{x:{ticks:{color:"white"}},y:{ticks:{color:"white"}}}
      }
    });

    new Chart(pie,{
      type:"doughnut",
      data:{
        labels:["Achieved","Remaining"],
        datasets:[{
          data:[TA,TT-TA],
          backgroundColor:["#38bdf8","#fb923c"]
        }]
      },
      options:{plugins:{legend:{labels:{color:"white"}}}}
    });
  }
});

setInterval(()=>location.reload(),60000);
</script>

</body>
</html>
